!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.watched=e()}):t.watched=e()}(this,function(){"use strict";var t;t={convert:function(t,e){return e={},t.on=function(n,r){return(e[n]||(e[n]=[])).push(r),t},t.once=function(e,n){function r(){n.apply(t.off(e,r),arguments)}return r.h=n,t.on(e,r)},t.off=function(n,r){for(var i=e[n],u=0;r&&i&&i[u];u++)i[u]!=r&&i[u].h!=r||i.splice(u--,1);return u||delete e[n],t},t.emit=function(n){for(var r=e[n],i=0;r&&r[i];)r[i++].apply(t,r.slice.call(arguments,1));return t},t}};var e=!0,n=!1,r=10,i=500,u=-1,o=1,c=2,s=3,f="DOMContentLoaded",a="querySelectorAll",l=[a],h=document,v=MutationObserver||WebKitMutationObserver||MozMutationObserver||null,d=null!==v,p=function(t){if("complete"===h.readyState)setTimeout(t,1);else{var e=function(){h.removeEventListener(f,e,n),t()};h.addEventListener(f,e,n)}},_=function(t){return Array.prototype.slice.call(t)},y=function(t,e){return e.indexOf(t)!==u},m=function(t){return t.slice(0)},b=function(t,e,n){var r;return function(){var i=this,u=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(i,u)},e),n&&!r&&t.apply(i,u)}},g=function(){var n=h.getElementsByTagName("*"),r=function(){return _(n)},u=function(t,n){return t.length!==n.length?e:t.some(function(t,e){return t!==n[e]})},c=function(){t.convert(this),this._currentElements=r()};return Object.defineProperties(c.prototype,{initialize:{value:function(){var t=this,e=function(){setTimeout(n,i)},n=function(){t._checkDom(),e()};e()}},_checkDom:{value:function(){var t=r();u(this._currentElements,t)&&(this._currentElements=t,this.emit(o))}}}),c}(),E=function(){var n={childList:e,subtree:e},i=function(t){return null!==t.addedNodes||null!==t.removedNodes},u=function(){t.convert(this)};return Object.defineProperties(u.prototype,{initialize:{value:function(){this._observer=new v(this._onMutation.bind(this)),this._observer.observe(h.body,n)}},_onMutation:{value:b(function(t){t.some(i,this)&&this.emit(o)},r)}}),u}(),O=function(){var t={};return t[a]=function(t,e){var n=t.querySelectorAll(e);return _(n)},{create:function(e,n,r){return function(){return t[e](n,r)}}}}(),M=function(t){this._query=t,this._old=[]};Object.defineProperties(M.prototype,{old:{value:function(){return m(this._old)}},current:{value:function(){return this._old=this._query(),m(this._old)}}});var q=function(t){this._el=t};l.forEach(function(t){Object.defineProperty(q.prototype,t,{value:function(e){var n=O.create(t,this._el,e),r=new M(n);return new w(r)}})});var w=function(){var e=function(){return new(d?E:g)}(),n=function(t,e){return t.filter(function(t){return!y(t,e)})};p(e.initialize.bind(e));var r=function(n){t.convert(this),this._length=0,this._query=n;var r=this._onMutate.bind(this);e.on(o,r),p(r)};return Object.defineProperties(r.prototype,{_onMutate:{value:function(){var t,e,r=this._query.old(),i=this._query.current();t=n(i,r),e=n(r,i),this._updateArray(i),this._bubble(c,t),this._bubble(s,e)}},_updateArray:{value:function(t){this.forEach(function(t,e){delete this[e]},this),this._length=t.length,t.forEach(function(t,e){this[e]=t},this)}},_bubble:{value:function(t,e){e.length>0&&this.emit(t,e)}},added:{value:function(t){this.on(c,t)}},removed:{value:function(t){this.on(s,t)}},forEach:{value:function(){Array.prototype.forEach.apply(this,arguments)}},length:{get:function(){return this._length}},splice:{value:function(){}}}),r}(),A=function(t){return new q(t)};return A});